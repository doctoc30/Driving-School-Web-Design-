26


document.addEventListener("DOMContentLoaded", () => {
  // ------------------ TYPEWRITER --------------------
  const el = document.getElementById('typewriter');
  let lines = [];
  const typingSpeed = 100;
  const lineDelay = 500;
  let currentLine = 0;
  let currentChar = 0;
  let lineEl = null;

  const cursor = document.createElement('span');
  cursor.classList.add('cursor');
  el.appendChild(cursor);

  function setLinesByOrientation() {
    lines = window.matchMedia("(orientation: landscape)").matches
      ? ["We build", "your website.", "You approve,", "then pay."]
      : ["We build", "your", "website.", "You approve,", "then pay."];
  }

  function typeChar() {
    if (currentLine >= lines.length) {
      cursor.remove();
      setTimeout(() => {
        el.style.animation = 'rocketRise 2s ease forwards';
        setTimeout(() => {
          showScreen('main-intro-options');
          document.getElementById('skipToPackages')?.style.display = 'block';
        }, 2000);
      }, 1000);
      return;
    }

    const text = lines[currentLine];
    if (!lineEl) {
      lineEl = document.createElement('div');
      lineEl.classList.add('typed-line');
      el.appendChild(lineEl);
      lineEl.appendChild(cursor);
    }

    if (currentChar < text.length) {
      const char = document.createTextNode(text[currentChar]);
      lineEl.insertBefore(char, cursor);
      currentChar++;
      setTimeout(typeChar, typingSpeed);
    } else {
      currentLine++;
      currentChar = 0;
      lineEl = null;
      setTimeout(typeChar, lineDelay);
    }
  }

  function debounce(func, wait) {
    let timeout;
    return function (...args) {
      clearTimeout(timeout);
      timeout = setTimeout(() => func.apply(this, args), wait);
    };
  }

  window.addEventListener('resize', debounce(() => {
    currentLine = 0;
    currentChar = 0;
    lineEl = null;
    el.textContent = '';
    el.appendChild(cursor);
    setLinesByOrientation();
    el.style.opacity = 1;
    typeChar();
  }, 300));

  setLinesByOrientation();
  el.style.opacity = 1;
  typeChar();


  // ------------------ FORM FLOW --------------------
  const screens = document.querySelectorAll(".form-screen");
  let features = [];
  let userPath = "";

  function hideAllScreens() {
    screens.forEach(s => {
      s.classList.remove("active");
      s.style.display = "none";
    });
  }

  function showScreen(id) {
    hideAllScreens();
    const screen = document.getElementById(id);
    if (screen) {
      screen.classList.add("active");
      screen.style.display = "block";
    }
    const skipBtn = document.getElementById("skipToPackages");
    if (skipBtn) skipBtn.style.display = (id === "plan-recommendation") ? "none" : "block";
  }

  function next() {
    const current = document.querySelector('.form-screen.active');
    const allScreens = Array.from(screens);
    const i = allScreens.indexOf(current);
    if (i >= 0 && i < allScreens.length - 1) {
      showScreen(allScreens[i + 1].id);
      if(allScreens[i + 1].id === 'plan-recommendation') recommendPlan();
    }
  }

  function prev() {
    const current = document.querySelector('.form-screen.active');
    const allScreens = Array.from(screens);
    const i = allScreens.indexOf(current);
    if (i > 0) showScreen(allScreens[i - 1].id);
  }

  function setPath(path) {
    userPath = path;
    next();
  }

  function recordFeature(feature) {
    if (!features.includes(feature)) features.push(feature);
  }

  function recommendPlan() {
    let plan = '';
    const count = features.length;
    if(count <= 3) plan = 'Basic Plan: Simple website + booking/contact';
    else if(count <= 6) plan = 'Standard Plan: Booking, payments, SEO, branding help';
    else plan = 'Premium Plan: Full features including lesson packages, social media, content help, and professional email';
    document.getElementById('recommended-plan').innerText = plan;
  }

  hideAllScreens();


  // ------------------ CONCEPT PREVIEW --------------------
  const conceptInput = document.getElementById("designInput");
  const previewImg = document.getElementById("previewImg");

  if(conceptInput && previewImg) {
    conceptInput.addEventListener('input', () => {
      const code = conceptInput.value.trim().toUpperCase();
      previewImg.src = code ? `images/${code}.png` : "images/placeholder.png";
      previewImg.onerror = () => { previewImg.src = "images/placeholder.png"; };
    });
  }

  function goToInstructorFunnel() {
    showScreen("instructor-q1");
  }

  function goToConcept() {
    const code = conceptInput.value.trim().toUpperCase();
    if (!code) {
      alert("Please enter a design code.");
      return;
    }
    // Show confirmation preview
    const previewContainer = document.getElementById("recommended-plan");
    previewContainer.innerHTML = `
      <p>You selected: <strong>${code}</strong></p>
      <button type="button" onclick="goToInstructorFunnel()">I want this concept</button>
    `;
    showScreen("plan-recommendation");
  }

  // ------------------ CONCEPT SLIDER --------------------
  const urlParams = new URLSearchParams(window.location.search);
  const code = urlParams.get('code');
  const slides = document.querySelectorAll('.slide');
  const sliderContainer = document.querySelector('.slider-container');

  if (code && slides.length > 0) {
    slides.forEach(slide => slide.style.display = 'none');
    const chosenSlide = document.querySelector(`.slide[data-code="${code}"]`);
    if (chosenSlide) chosenSlide.style.display = 'block';
    document.body.classList.add('single-concept');
  }

  document.querySelectorAll('.choose-concept').forEach(btn => {
    btn.addEventListener('click', () => {
      if(sliderContainer) sliderContainer.style.display = 'none';
      showScreen('instructor-q1');
      window.scrollTo(0, 0);
    });
  });


  // ------------------ HAMBURGER MENU --------------------
  const hamburger = document.querySelector('.hamburger');
  const menu = document.querySelector('nav.menu');

  function toggleMenu() {
    const isOpen = menu.classList.toggle('open');
    hamburger.classList.toggle('active');
    hamburger.setAttribute('aria-expanded', isOpen);
    menu.setAttribute('aria-hidden', !isOpen);
    document.body.style.overflow = isOpen ? 'hidden' : '';
  }

  if (hamburger && menu) {
    hamburger.addEventListener('click', e => { e.stopPropagation(); toggleMenu(); });
    document.addEventListener('click', e => {
      if (!menu.contains(e.target) && !hamburger.contains(e.target)) {
        menu.classList.remove('open');
        hamburger.classList.remove('active');
        hamburger.setAttribute('aria-expanded', false);
        menu.setAttribute('aria-hidden', true);
        document.body.style.overflow = '';
      }
    });
  }

  // ------------------ REDIRECT --------------------
  document.getElementById("pricing-redirect")?.addEventListener("click", () => {
    if (userPath === "instructor") window.location.href = "https://yourwebsite.com/pricing-instructor";
    else if (userPath === "school") window.location.href = "https://yourwebsite.com/pricing-school";
    else window.location.href = "https://yourwebsite.com/pricing";
  });
});
