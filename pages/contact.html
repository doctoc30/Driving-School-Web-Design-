<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Lesson Progress Tracker</title>

<style>
    body {
        font-family: Arial, sans-serif;
        padding: 20px;
        max-width: 700px;
        margin: auto;
        background: #f7f7f7;
    }

    h2 {
        margin-top: 30px;
    }

    .card {
        background: #fff;
        padding: 20px;
        border-radius: 10px;
        margin-bottom: 25px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.08);
    }

    label {
        display: block;
        margin: 8px 0;
    }

    textarea {
        width: 100%;
        height: 80px;
        padding: 10px;
        border-radius: 8px;
        border: 1px solid #ccc;
    }

    button {
        padding: 12px 20px;
        border: none;
        background: black;
        color: white;
        border-radius: 8px;
        cursor: pointer;
        margin-top: 10px;
    }

    .progress-bar {
        width: 100%;
        height: 10px;
        background: #eee;
        border-radius: 5px;
        margin-top: 10px;
    }

    .progress-fill {
        height: 10px;
        width: 0%;
        background: #2ecc71;
        border-radius: 5px;
    }

    input[type="checkbox"] {
        transform: scale(1.3);
        margin-right: 10px;
    }

    .share-link-box {
        padding: 10px;
        background: #e8e8e8;
        border-radius: 8px;
        margin-top: 10px;
        word-break: break-all;
    }
</style>
</head>

<body>

<h1>Lesson Progress Tracker</h1>

<div class="card">
    <h2>Select Student</h2>
    <input id="studentName" type="text" placeholder="Enter student name..." style="width:100%;padding:10px;border-radius:8px;border:1px solid #ccc;">
    <button onclick="loadStudent()">Load Student</button>
</div>

<div id="trackerArea" style="display:none;">

    <div class="card">
        <h2>Progress Checklist</h2>
        <label><input type="checkbox" class="skill" data-skill="cockpit"> Cockpit Drill</label>
        <label><input type="checkbox" class="skill" data-skill="moving_off"> Moving Off Safely</label>
        <label><input type="checkbox" class="skill" data-skill="clutch"> Clutch Control</label>
        <label><input type="checkbox" class="skill" data-skill="junctions"> Junctions</label>
        <label><input type="checkbox" class="skill" data-skill="roundabouts"> Roundabouts</label>
        <label><input type="checkbox" class="skill" data-skill="manoeuvres"> Manoeuvres</label>

        <h3>Overall Progress</h3>
        <div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>
        <p id="progressPercent">0% complete</p>
    </div>

    <div class="card">
        <h2>Instructor Notes</h2>
        <textarea id="notes"></textarea>
        <button onclick="saveData()">Save Progress</button>
    </div>

    <div class="card">
        <h2>Share With Student</h2>
        <button onclick="generateShareLink()">Generate Student Link</button>
        <div id="linkOutput" class="share-link-box" style="display:none;"></div>
    </div>

</div>

<script>
let currentStudent = null;

function loadStudent() {
    const name = document.getElementById("studentName").value.trim();
    if (!name) return alert("Enter a student name.");

    currentStudent = name;
    document.getElementById("trackerArea").style.display = "block";

    // Load saved data
    const saved = JSON.parse(localStorage.getItem("student_" + name) || "{}");

    document.querySelectorAll(".skill").forEach(chk => {
        chk.checked = saved[chk.dataset.skill] || false;
    });

    document.getElementById("notes").value = saved.notes || "";

    updateProgress();
}

function saveData() {
    if (!currentStudent) return;

    const data = {};
    document.querySelectorAll(".skill").forEach(chk => {
        data[chk.dataset.skill] = chk.checked;
    });

    data.notes = document.getElementById("notes").value;

    localStorage.setItem("student_" + currentStudent, JSON.stringify(data));

    alert("Progress saved!");
}

document.querySelectorAll(".skill").forEach(chk => {
    chk.addEventListener("change", updateProgress);
});

function updateProgress() {
    const skills = document.querySelectorAll(".skill");
    const done = Array.from(skills).filter(s => s.checked).length;
    const total = skills.length;
    const percent = Math.round((done / total) * 100);

    document.getElementById("progressFill").style.width = percent + "%";
    document.getElementById("progressPercent").innerText = percent + "% complete";
}

function generateShareLink() {
    const saved = JSON.parse(localStorage.getItem("student_" + currentStudent) || "{}");
    const encoded = encodeURIComponent(JSON.stringify(saved));
    const link = window.location.href.split("?")[0] + "?data=" + encoded;

    const box = document.getElementById("linkOutput");
    box.style.display = "block";
    box.innerText = link;
}

// READ-ONLY MODE FOR STUDENTS
const urlParams = new URLSearchParams(window.location.search);
if (urlParams.get("data")) {
    const data = JSON.parse(decodeURIComponent(urlParams.get("data")));

    document.body.innerHTML = `
        <h1>Lesson Progress Overview</h1>
        <div class="card">
            <h2>Your Progress</h2>
            <p>${Object.values(data).filter(v => v === true).length} skills completed</p>
        </div>

        <div class="card">
            <h2>Instructor Notes</h2>
            <p>${data.notes || "No notes yet."}</p>
        </div>
    `;
}
</script>

</body>
</html>
