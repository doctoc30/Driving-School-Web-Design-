<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Realistic Walkthrough</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body {
  margin: 0;
  background: #000;
  overflow: hidden;
  font-family: Arial, sans-serif;
  color: #fff;
}
header {
  padding: 15px;
  text-align: center;
  background: #111;
  border-bottom: 1px solid #222;
}
input {
  margin-top: 10px;
}
#viewer {
  position: relative;
  width: 100vw;
  height: calc(100vh - 80px);
  overflow: hidden;
  background: black;
}
.frame-layer {
  position: absolute;
  inset: 0;
  background-size: cover;
  background-position: center;
  opacity: 0;
  transition: opacity 2s ease;
}
.frame-layer.active {
  opacity: 1;
}
</style>
</head>
<body>
<header>
  <h2>Realistic Walkthrough Tester</h2>
  <p>Upload layers: Foreground first, Background second</p>
  <input type="file" id="upload" multiple accept="image/*">
</header>
<div id="viewer"></div>

<script>
const viewer = document.getElementById("viewer");
const upload = document.getElementById("upload");

let frames = []; // array of frames, each frame = array of layers
let current = 0;
const DISPLAY_TIME = 6500; // per frame
const TRANSITION_TIME = 2000;

upload.addEventListener("change", (e) => {
  viewer.innerHTML = "";
  frames = [];
  current = 0;

  const files = [...e.target.files];
  // assume layers uploaded sequentially: fg/bg
  for (let i = 0; i < files.length; i += 2) {
    const fgURL = URL.createObjectURL(files[i]);
    const bgURL = files[i+1] ? URL.createObjectURL(files[i+1]) : fgURL;

    const fg = document.createElement("div");
    fg.className = "frame-layer";
    fg.style.backgroundImage = `url(${fgURL})`;
    viewer.appendChild(fg);

    const bg = document.createElement("div");
    bg.className = "frame-layer";
    bg.style.backgroundImage = `url(${bgURL})`;
    viewer.appendChild(bg);

    frames.push([fg, bg]);
  }

  if (frames.length) startWalkthrough();
});

function startWalkthrough() {
  showFrame(0);
}

function showFrame(index) {
  const layers = frames[index];
  layers.forEach(layer => layer.classList.add("active"));

  animateFrame(layers);

  setTimeout(() => {
    layers.forEach(layer => layer.classList.remove("active"));
    current = (current + 1) % frames.length;
    showFrame(current);
  }, DISPLAY_TIME);
}

function animateFrame(layers) {
  const start = performance.now();
  const duration = DISPLAY_TIME;

  const startScale = 1;
  const endScale = 1.06;

  // subtle random sway for human motion
  const swayX = (Math.random() * 4 - 2);
  const swayY = (Math.random() * 3 - 1.5);

  function step(now) {
    let t = (now - start) / duration;
    t = Math.min(t, 1);
    const ease = t*t*(3-2*t);

    layers.forEach((layer, i) => {
      const depthFactor = i === 0 ? 1.2 : 0.8; // fg moves faster, bg slower
      const scale = startScale + (endScale - startScale)*ease;
      layer.style.transform = `
        scale(${scale})
        translate(${swayX*ease*depthFactor}px, ${swayY*ease*depthFactor}px)
      `;
    });

    if (t < 1) requestAnimationFrame(step);
  }

  requestAnimationFrame(step);
}
</script>
</body>
</html>
